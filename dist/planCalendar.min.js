"use strict";var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e(require("jquery")):t.PlanCalendar=e(t.jQuery)}(window,function(t){return function(){function e(a){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,e);var r={monthNum:4,sellOutText:"售罄",isTips:!1,maxNum:20,maxNumText:"充足",markDates:[],onSelect:function(t,e){},initTips:function(t){}};for(var l in r)if(void 0===i[l])i[l]=r[l];else if("object"===_typeof(i[l]))for(var s in i[l])void 0===i[l][s]&&(i[l][s]=r[l][s]);this.options=i,this.data=this.options.markDates.map(function(t){for(var e in t)"date"===e&&(t[e]=n.formatDate(t.date));return t}),this.options.monthNum=this.options.monthNum>11?11:this.options.monthNum,this.selectedDate=void 0,this.$cal=t(a),this.$cal.html('<ul class="calendar-month"> </ul> <ul class="calendar-week"> <li>日</li> <li>一</li> <li>二</li> <li>三</li> <li>四</li> <li>五</li> <li>六</li> </ul> <ul class="calendar-date"> </ul>'),this.$calMonth=this.$cal.children(".calendar-month"),this.$calDate=this.$cal.children(".calendar-date"),this.weekCn=["日","一","二","三","四","五","六"];var o=new Date,c=[o.getFullYear(),o.getMonth(),o.getDate()],d=c[0],u=c[1],h=c[2];this.getCalMonth(d,u,this.options.monthNum),this.getCalDate(d,u,h);var f=this;this.$calMonth.on("click","li",function(){t(this).addClass("active").siblings().removeClass("active");var e=t(this).index(),a=u+e>11?d+1:d,n=u+e>11?u-12+e:u+e;f.getCalDate(a,n)}),this.$calDate.on("click","li.enabled",function(){f.selectCalDate(this,f.options.onSelect)})}return _createClass(e,[{key:"formatDate",value:function(){for(var t=arguments.length,e=Array(t),a=0;a<t;a++)e[a]=arguments[a];if("string"==typeof e[0]&&-1!==e[0].indexOf("-")&&8===e[0].length)return e[0];var n=3===e.length?new Date(e[0],e[1],e[2]):new Date(e[0]),i=n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1,r=n.getDate()<10?"0"+n.getDate():n.getDate();return[n.getFullYear(),i,r].join("-")}},{key:"getEndDate",value:function(t,e){var a=new Date(t);return this.formatDate(a.getFullYear(),a.getMonth(),a.getDate()+e)}},{key:"getMinPrice",value:function(t,e){if(0===this.data.length)return'<p class="none">无团期</p>';var a=this.data.filter(function(a){return a.date.split("-")[0]==t&&parseInt(a.date.split("-")[1])==e});if(0===a.length)return'<p class="none">无团期</p>';var n=a.map(function(t){return t.price}).sort(function(t,e){return t-e})[0];return n?'<p class="price">&yen;'+n+"起</p>":'<p class="price">未设置</p>'}},{key:"renderPlanData",value:function(t,e,a,n){var i=this,r=this.formatDate(e,a,n),l=this.options,s=[],o=[],c=[];this.data.sort(function(t,e){return e.number-t.number}).forEach(function(t){var e=t.date;-1===c.indexOf(e)?(c.push(e),o.push(t)):s.push(t.date)}),o.forEach(function(e,a){var n=e.date;if(n===r){var o=(void 0===e.price?"":'<p class="price">&yen;'+e.price+"起</p>")+'<p class="number">'+(c=e.number,c<l.maxNum?"余："+c:c>=l.maxNum?l.maxNumText:"")+"</p>";t.addClass("enabled").attr("data-start",n).attr("data-end",i.getEndDate(e.date,e.days)).append(o),n===i.selectedDate&&t.addClass("selected"),-1!==s.indexOf(r)&&t.append('<i class="badge">多团</i>'),void 0!==e.number&&0===e.number&&t.append('<i class="badge">'+i.options.sellOutText+"</i>"),i.options.isTips&&"undefined"!==i.options.initTips&&!t.hasClass("invalid")&&t.append(i.options.initTips(e))}var c})}},{key:"renderCalDate",value:function(t,e,a,n){var i=this;t.attr("data-date",function(){return i.formatDate(e,a,n)}).attr("data-week",function(){return i.weekCn[new Date(e,a,n).getDay()]}).html('<p class="date">'+n+"</p>")}},{key:"getCalMonth",value:function(t,e,a){for(var n="",i=0;i<a;i++){e+i>11&&(t++,e=-i);var r=e+1+i;n+='<li data-year="'+t+'"  data-month="'+r+'" class="'+(0===i?"active":"")+'"><p class="month">'+t+"年"+r+"月</p>"+this.getMinPrice(t,r)+"</li>"}this.$calMonth.html(n)}},{key:"getCalDate",value:function(t,e,a){this.data;var n=new Date,i=t,r=e,l=a||n.getDate(),s=[31,i%4==0&&i%100!=0||i%400==0?29:28,31,30,31,30,31,31,30,31,30,31],o=0,c=new Date(i,r,1).getDay(),d=c+s[r];this.$calDate.html("");for(var u=0;u<42;u++)this.$calDate.append("<li></li>");var h=this.$calDate.children("li");h.removeAttr("class");for(var f=0;f<42;f++)if(f>=c&&f<d){var p=f-(c-1);this.renderCalDate(h.eq(f),i,r,p),this.renderPlanData(h.eq(f),i,r,p),i===n.getFullYear()&&r===n.getMonth()&&l===p&&h.eq(f).addClass("today").children(".date").html("今天")}else if(f<c){for(var v=0===r?11:r-1,m=0===r?i-1:i,D=s[v];D>s[v]-c;D--)if(f===s[v]-D){var g=s[v]-(c-1-f);h.eq(f).addClass("invalid"),this.renderCalDate(h.eq(f),m,v,g),this.renderPlanData(h.eq(f),m,v,g);break}}else{var y=11===r?0:r+1,C=11===r?i+1:i,b=++o;h.eq(f).addClass("invalid"),this.renderCalDate(h.eq(f),C,y,b),this.renderPlanData(h.eq(f),C,y,b)}}},{key:"selectCalDate",value:function(e,a){var n=t(e).attr("data-date"),i=this.$calMonth.children("li.active"),r=i.attr("data-month")-1,l=0===r?11:r-1,s=11===r?0:r+1;t(e).addClass("selected").siblings().removeClass("selected"),this.selectedDate=n;var o=this.data.filter(function(t,e){return t.date===n&&(new Date(t.date).getMonth()===s?i.next().click():new Date(t.date).getMonth()===l&&i.prev().click()),t.date===n}),c=this.$calDate.children("li.selected");"function"==typeof a&&a(c,o)}}]),e}()});
//# sourceMappingURL=planCalendar.min.js.map
