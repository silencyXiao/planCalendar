"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t,e,a){var n=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,t);var i={monthNum:4,sellOutText:"售罄",isTips:!1,maxNum:20,maxNumText:"充足",markDates:[],onSelect:function(t,e){},initTips:function(t){}};for(var l in i)if(void 0===n[l])n[l]=i[l];else if("object"===_typeof(n[l]))for(var r in n[l])void 0===n[l][r]&&(n[l][r]=i[l][r]);this.options=n,this.data=this.options.markDates,this.options.monthNum=this.options.monthNum>11?11:this.options.monthNum,this.selectedDate=void 0,this.$cal=a(e),this.$cal.html('<ul class="calendar-month"> </ul> <ul class="calendar-week"> <li>日</li> <li>一</li> <li>二</li> <li>三</li> <li>四</li> <li>五</li> <li>六</li> </ul> <ul class="calendar-date"> </ul>'),this.$calMonth=this.$cal.children(".calendar-month"),this.$calDate=this.$cal.children(".calendar-date"),this.weekCn=["日","一","二","三","四","五","六"];var s=new Date,o=[s.getFullYear(),s.getMonth(),s.getDate()],c=o[0],d=o[1],h=o[2];this.getCalMonth(c,d,this.options.monthNum),this.getCalDate(c,d,h);var u=this;this.$calMonth.on("click","li",function(){a(this).addClass("active").siblings().removeClass("active");var t=a(this).index(),e=d+t>11?c+1:c,n=d+t>11?d-12+t:d+t;u.getCalDate(e,n)}),this.$calDate.on("click","li.enabled",function(){u.selectCalDate(this,u.options.onSelect)})}return _createClass(t,[{key:"formatDate",value:function(){for(var t=arguments.length,e=Array(t),a=0;a<t;a++)e[a]=arguments[a];if("string"==typeof e[0]&&-1!==e[0].indexOf("-")&&8===e[0].length)return e[0];var n=3===e.length?new Date(e[0],e[1],e[2]):new Date(e[0]),i=n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1,l=n.getDate()<10?"0"+n.getDate():n.getDate();return[n.getFullYear(),i,l].join("-")}},{key:"getEndDate",value:function(t,e){var a=new Date(t);return this.formatDate(a.getFullYear(),a.getMonth(),a.getDate()+e)}},{key:"getMinPrice",value:function(t,e){var a=this;if(0===this.data.length)return'<p class="none">无团期</p>';var n=this.data.filter(function(n){return a.formatDate(n.date).split("-")[0]==t&&parseInt(a.formatDate(n.date).split("-")[1])==e});if(0===n.length)return'<p class="none">无团期</p>';var i=n.map(function(t){return t.price}).sort()[0];return i?'<p class="price">&yen;'+i+"起</p>":'<p class="price">未设置</p>'}},{key:"renderPlanData",value:function(t,e,a,n){var i=this,l=this.options;this.data.forEach(function(r,s){if(i.formatDate(r.date)===i.formatDate(e,a,n)){var o=(void 0===r.price?"":'<p class="price">&yen;'+r.price+"起</p>")+'<p class="number">'+(c=r.number,c<l.maxNum?"余："+c:c>=l.maxNum?l.maxNumText:"")+"</p>";t.addClass("enabled").attr("data-start",i.formatDate(r.date)).attr("data-end",i.getEndDate(r.date,r.days)).append(o),i.formatDate(r.date)===i.selectedDate&&t.addClass("selected"),void 0!==r.number&&0===r.number&&t.append('<i class="badge">'+i.options.sellOutText+"</i>"),i.options.isTips&&"undefined"!==i.options.initTips&&!t.hasClass("invalid")&&t.append(i.options.initTips(s))}var c})}},{key:"renderCalDate",value:function(t,e,a,n){var i=this;t.attr("data-date",function(){return i.formatDate(e,a,n)}).attr("data-week",function(){return i.weekCn[new Date(e,a,n).getDay()]}).html('<p class="date">'+n+"</p>")}},{key:"getCalMonth",value:function(t,e,a){for(var n="",i=0;i<a;i++){e+i>11&&(t++,e=-i);var l=e+1+i;n+='<li data-year="'+t+'"  data-month="'+l+'" class="'+(0===i?"active":"")+'"><p class="month">'+t+"年"+l+"月</p>"+this.getMinPrice(t,l)+"</li>"}this.$calMonth.html(n)}},{key:"getCalDate",value:function(t,e,a){this.data;var n=new Date,i=t,l=e,r=a||n.getDate(),s=[31,i%4==0&&i%100!=0||i%400==0?29:28,31,30,31,30,31,31,30,31,30,31],o=0,c=new Date(i,l,1).getDay(),d=c+s[l];this.$calDate.html("");for(var h=0;h<42;h++)this.$calDate.append("<li></li>");var u=this.$calDate.children("li");u.removeAttr("class");for(var f=0;f<42;f++)if(f>=c&&f<d){var p=f-(c-1);this.renderCalDate(u.eq(f),i,l,p),this.renderPlanData(u.eq(f),i,l,p),i===n.getFullYear()&&l===n.getMonth()&&r===p&&u.eq(f).addClass("today").children(".date").html("今天")}else if(f<c){for(var m=0===l?11:l-1,v=0===l?i-1:i,D=s[m];D>s[m]-c;D--)if(f===s[m]-D){var g=s[m]-(c-1-f);u.eq(f).addClass("invalid"),this.renderCalDate(u.eq(f),v,m,g),this.renderPlanData(u.eq(f),v,m,g);break}}else{this.data;var y=11===l?0:l+1,C=11===l?i+1:i,b=++o;u.eq(f).addClass("invalid"),this.renderCalDate(u.eq(f),C,y,b),this.renderPlanData(u.eq(f),C,y,b)}}},{key:"selectCalDate",value:function(t,e){var n=this,i=a(t).attr("data-date"),l=this.$calMonth.children("li.active"),r=l.attr("data-month")-1,s=0===r?11:r-1,o=11===r?0:r+1;a(t).addClass("selected").siblings().removeClass("selected"),this.selectedDate=i,this.data.forEach(function(t,a){if(n.formatDate(t.date)===i){new Date(t.date).getMonth()===o?l.next().click():new Date(t.date).getMonth()===s&&l.prev().click();var r=n.$calDate.children("li.selected");"function"==typeof e&&e(r,a)}})}}]),t}();t.PlanCalendar=n}(window,document,$);
//# sourceMappingURL=planCalendar.min.js.map
