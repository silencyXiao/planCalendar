"use strict";var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e,t){"function"==typeof define&&define.amd?define(t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?exports=module.exports=t():e.PlanCalendar=t()}(window,function(){function e(e){return e>=10?e:"0"+e}function t(t,a){var i="date"===n(t)?t:new Date(t),r=a||"yyyy/mm/dd",s=i.getFullYear(),l=e(i.getMonth()+1),o=e(i.getDate()),u=r.match(/[-/\s年月日]/g);return""+s+u[0]+l+u[1]+o+(u[2]?u[2]:"")}function n(e){var t=Object.prototype.toString;return"[object Array]"===t.call(e)?"array":"[object Object]"===t.call(e)?"object":"[object Date]"===t.call(e)?"date":void 0}function a(e,t){return e.className.includes(t)}function i(e,t){a(e,t)||(e.className+=" "+t)}function r(e,t){if(a(e,t)){var n=new RegExp("(\\s|^)"+t);e.className=e.className.replace(n,"")}}return function(){function e(a,i){_classCallCheck(this,e);this.$el=(r=a,1===r.nodeType?a:document.querySelector(a));var r;this.$options=function e(t,a){for(var i in t)void 0===a[i]?a[i]=t[i]:"object"===n(a[i])&&e(t[i],a[i]);return a}({monthNum:4,startByData:!1,showExpiredData:!1,minPriceText:"无团期",sellOutText:"售罄",maxNum:20,maxNumText:"充足",defineNumText:"",markDates:[],disableDates:[],onSelect:function(e){},onMouseEnter:function(e){},onMouseLeave:function(){}},i),this.$data=this.optimizeData(),this.$options.startByData=this.$options.startByData&&!this.$options.showExpiredData,this.$startDate=this.$data.length>0?this.$data[0].date:t(new Date),this.$seletedDate="",this.initCalendar()}return _createClass(e,[{key:"optimizeData",value:function(){var e=new Date,n=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime(),a=this.$options.markDates.reduce(function(e,n){return n.date=t(new Date(n.date)),e.push(n),e},[]).sort(function(e,t){return new Date(e.date).getTime()-new Date(t.date).getTime()});return this.$options.showExpiredData?a:a.filter(function(e){return n<=new Date(e.date).getTime()})}},{key:"initCalendar",value:function(){var e=this,t=this.$options,n=t.startByData?+this.$startDate.split("/")[0]:(new Date).getFullYear(),a=t.startByData?+this.$startDate.split("/")[1]-1:(new Date).getMonth(),s=0,l=this.createElem("span","calendar-btn-prev","&lt;"),o=this.createElem("span","calendar-btn-next","&gt;"),u=this.createElem("ul","calendar-month",this.getCalMonthHtml(n,a,s));this.createElem("ul","calendar-week",this.getCalWeek());var c=this.createElem("ul","calendar-date",this.getCalDateHtml(n,a));this.on("click",u,"li",function(t,l){t.childNodes.forEach(function(e){return r(e,"active")}),i(l,"active");for(var o=0;o<t.childNodes.length;o++)if(t.childNodes[o]===l){s=o;break}n=+l.getAttribute("data-year"),a=+l.getAttribute("data-month")-1,c.innerHTML=e.getCalDateHtml(n,a)}),this.on("click",c,".enabled",function(n,a){n.childNodes.forEach(function(e){return r(e,"selected")}),i(a,"selected"),e.$seletedDate=a.getAttribute("data-date"),t.onSelect(e.getPlanDateData(e.$seletedDate)),a.className.includes("prev")&&u.childNodes[s].previousSibling.click(),a.className.includes("next")&&u.childNodes[s].nextSibling.click()}),this.on("mouseover",c,".enabled",function(n,a,i){var r=a.getAttribute("data-date");i===a||a.contains(i)||"enabled"!==a.className.trim()&&!a.className.includes("selected")||t.onMouseEnter(e.getPlanDateData(r))}),this.on("mouseout",c,".enabled",function(e,n,a){a===n||n.contains(a)||"enabled"!==n.className.trim()&&!n.className.includes("selected")||t.onMouseLeave()}),l.addEventListener("click",function(){n=0===a?--n:n,a=0===a?11:--a,0===s?(s=0,u.innerHTML=e.getCalMonthHtml(n,a,s),c.innerHTML=e.getCalDateHtml(n,a)):u.childNodes[s].previousSibling.click()}),o.addEventListener("click",function(){n=11===a?++n:n,a=11===a?0:++a,s===t.monthNum-1?(s=0,u.innerHTML=e.getCalMonthHtml(n,a,s),c.innerHTML=e.getCalDateHtml(n,a)):u.childNodes[s].nextSibling.click()})}},{key:"on",value:function(e,t,n,a){t.addEventListener(e,function(e){var t=function e(t,n,a){if("BODY"===t.parentNode.nodeName)return null;if(t.parentNode===n)return t.nodeName.toLowerCase()===a||t.className.includes(a.substring(1))||t.id.includes(a.substring(1))?t:null;return t.parentNode!==n?e(t.parentNode,n,a):null}(e.target||e.srcElement,this,n),i=e.relatedTarget;t&&a&&a(this,t,i)})}},{key:"createElem",value:function(e,t,n){var a=document.createElement(e);return a.className=t,a.innerHTML=n,this.$el.append(a),a}},{key:"getPlanDate",value:function(e,n,a){for(var i=this.$options,r=this.getUniqueData(),s=0;s<r.length;s++)if(t(new Date(e,n,a))===r[s].date){return(this.getPlanDateData(e,n,a).length>1?'<i class="badge">多团</i>':0===r[s].number?'<i class="badge">'+i.sellOutText+"</i>":"")+'\n            <p class="price">&yen;'+r[s].price+'起</p>\n            <p class="number">'+this.toNumText(r[s].number)+"</p>"}}},{key:"getUniqueData",value:function(e){var t=[],n=this.$data.sort(function(e,t){return e.price-t.price}).reduce(function(e,n){return-1===t.indexOf(n.date)&&(e.push(n),t.push(n.date)),e},[]);return"date"===e?t:n}},{key:"getPlanDateData",value:function(){var e=1===arguments.length?t(new Date(arguments.length<=0?void 0:arguments[0])):t(new Date(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]));return this.$data.filter(function(t){return t.date===e}).sort(function(e,t){return e.price-t.price})}},{key:"getCalDateHtml",value:function(e,t){new Date;for(var n="",a=(this.$options,this.getCalDateData(e,t)),i=(this.getUniqueData("date"),0);i<a.length;i++)"prev"===a[i].status?n+=this.getPlanDateHtml(a[i].date,"prev"):"current"===a[i].status?n+=this.getPlanDateHtml(a[i].date,"current"):"next"===a[i].status&&(n+=this.getPlanDateHtml(a[i].date,"next"));return n}},{key:"getPlanDateHtml",value:function(e,t){var n=this.getUniqueData("date"),a=+e.split("/")[0],i=+e.split("/")[1]-1,r=+e.split("/")[2],s=new Date(e).getDay(),l=this.isToday(a,i,r),o=this.isDisabled(e)?"disabled":"enabled",u=this.$seletedDate===e?"selected":"",c="current"!==t?"invalid "+t:"",d="今天"===l?"today":"";return-1!==n.indexOf(e)?'<li class="'+o+" "+u+" "+c+" "+d+'" data-date="'+e+'" data-week="'+s+'">\n            <p class="date">'+l+"</p>\n            "+this.getPlanDate(a,i,r)+"\n          </li>":'<li class="'+c+" "+d+'" data-date="'+e+'" data-week="'+s+'"><p class="date">'+l+"</p></li>"}},{key:"getCalDateData",value:function(e,n){for(var a=[31,e%4==0&&e%100!=0||e%400==0?29:28,31,30,31,30,31,31,30,31,30,31],i=new Date(e,n,1).getDay(),r=i+(a[n]-1),s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(){return++e}}(),l=[],o=0;o<42;o++)if(o<i){var u=0===n?11:n-1,c=t(new Date(0===n?e-1:e,u,a[u]-(i-1-o)));l.push({date:c,status:"prev"})}else if(o>=i&&o<=r){var d=t(new Date(e,n,o-i+1));l.push({date:d,status:"current"})}else{var h=t(new Date(11===n?e+1:e,11===n?0:n+1,s()));l.push({date:h,status:"next"})}return l}},{key:"getCalMonthHtml",value:function(e,t,n){for(var a="",i=e,r=t,s=0;s<this.$options.monthNum;s++){r=t+s,t+s>11&&(i=e+1,r=t+s-12);var l=this.getMinPrice(i,r),o=l===this.$options.minPriceText?l:"&yen;"+l+"起";a+='<li data-year="'+i+'" data-month="'+(r+1)+'" class="item \n          '+(s===n?"active":"")+'">\n          <p class="month">'+i+"年"+(r+1)+'月</p>\n          <p class="'+(l===this.$options.minPriceText?"none":"price")+'">'+o+"</p>\n        </li>"}return a}},{key:"getCalWeek",value:function(){for(var e=["日","一","二","三","四","五","六"],t="",n=0;n<e.length;n++)t+="<li>"+e[n]+"</li>";return t}},{key:"toNumText",value:function(e){var t=this.$options;return t.defineNumText?t.defineNumText:e>=t.maxNum?t.maxNumText:"余："+e}},{key:"isDisabled",value:function(e){var a=this.$options.disableDates;if("array"===n(a)){if(0===a.length)return!1;return-1!==a.map(function(e){return t(e)}).indexOf(e)}var i=new Date(e).getTime(),r=a.start?new Date(t(a.start)).getTime():(new Date).getTime(),s=a.end?new Date(t(a.end)).getTime():(new Date).getTime();return s-r<=0?(console.warn("disableDates的start日期不能大于end日期"),!1):i>=r&&i<=s}},{key:"getMinPrice",value:function(e,t,n){if(n)return this.getPlanDateData(e,t,n)[0];if(0===this.$data.length)return this.$options.minPriceText;var a=this.$data.filter(function(n){return+n.date.split("/")[0]===e&&+n.date.split("/")[1]===t+1});return 0!==a.length?a.map(function(e){return e.price}).sort(function(e,t){return e-t})[0]:this.$options.minPriceText}},{key:"getStart",value:function(e){var t=new Date;new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime();this.$options.startByData}},{key:"isToday",value:function(e,t,n){var a=new Date;return new Date(e,t,n).getTime()===new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime()?"今天":n}}]),e}()});
//# sourceMappingURL=planCalendar.min.js.map
