"use strict";var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e,t){"function"==typeof define&&define.amd?define(t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?exports=module.exports=t():e.PlanCalendar=t()}(window,function(){function e(e){return e>=10?e:"0"+e}function t(t,n){var i="date"===a(t)?t:new Date(t),r=n||"yyyy/mm/dd",s=i.getFullYear(),l=e(i.getMonth()+1),o=e(i.getDate()),u=r.match(/[-/\s年月日]/g);return""+s+u[0]+l+u[1]+o+(u[2]?u[2]:"")}function a(e){var t=Object.prototype.toString;return"[object Array]"===t.call(e)?"array":"[object Object]"===t.call(e)?"object":"[object Date]"===t.call(e)?"date":void 0}function n(e,t){return e.className.includes(t)}function i(e,t){n(e,t)||(e.className+=" "+t)}function r(e,t){if(n(e,t)){var a=new RegExp("(\\s|^)"+t);e.className=e.className.replace(a,"")}}return function(){function e(t,n){_classCallCheck(this,e);this.$el=(i=t,1===i.nodeType?t:document.querySelector(t));var i;this.$options=function e(t,n){for(var i in t)void 0===n[i]?n[i]=t[i]:"object"===a(n[i])&&e(t[i],n[i]);return n}({monthNum:4,startByData:!1,sellOutText:"售罄",maxNum:20,maxNumText:"充足",defineNumText:"",markDates:[],disableDates:[],onSelect:function(e){},onMouseEnter:function(e){},onMouseLeave:function(){}},n),this.$data=this.optimizeData(),this.$startDate=this.$data[0].date,this.$seletedDate="",this.initCalendar()}return _createClass(e,[{key:"optimizeData",value:function(){var e=this,a=new Date,n=new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime(),i=this.$options.markDates.reduce(function(e,a){return a.date=t(new Date(a.date)),e.push(a),e},[]).sort(function(e,t){return new Date(e.date).getTime()-new Date(t.date).getTime()}).filter(function(e){return n<=new Date(e.date).getTime()});return i.filter(function(t){var a=e.$options.startByData&&n<=new Date(i[0].date).getTime()?new Date(i[0].date):new Date(n),r=a.getTime();a.setMonth(a.getMonth()+e.$options.monthNum);var s=a.setDate(1);return new Date(t.date).getTime()>=r&&new Date(t.date).getTime()<s})}},{key:"initCalendar",value:function(){var e=this,t=this.$options,a=t.startByData?+this.$startDate.split("/")[0]:(new Date).getFullYear(),n=t.startByData?+this.$startDate.split("/")[1]-1:(new Date).getMonth(),s=0,l=this.createElem("span","calendar-btn-prev","&lt;"),o=this.createElem("span","calendar-btn-next","&gt;"),u=this.createElem("ul","calendar-month",this.getCalMonthHtml(a,n,s));this.createElem("ul","calendar-week",this.getCalWeek());var c=this.createElem("ul","calendar-date",this.getCalDateHtml(a,n));this.on("click",u,"li",function(t,l){t.childNodes.forEach(function(e){return r(e,"active")}),i(l,"active");for(var o=0;o<t.childNodes.length;o++)if(t.childNodes[o]===l){s=o;break}a=+l.getAttribute("data-year"),n=+l.getAttribute("data-month")-1,c.innerHTML=e.getCalDateHtml(a,n)}),this.on("click",c,".enabled",function(a,n){a.childNodes.forEach(function(e){return r(e,"selected")}),i(n,"selected"),e.$seletedDate=n.getAttribute("data-date"),t.onSelect(e.getPlanDateData(e.$seletedDate)),n.className.includes("prev")&&u.childNodes[s].previousSibling.click(),n.className.includes("next")&&u.childNodes[s].nextSibling.click()}),this.on("mouseover",c,".enabled",function(a,n,i){var r=n.getAttribute("data-date");i===n||n.contains(i)||"enabled"!==n.className.trim()&&!n.className.includes("selected")||t.onMouseEnter(e.getPlanDateData(r))}),this.on("mouseout",c,".enabled",function(e,a,n){n===a||a.contains(n)||"enabled"!==a.className.trim()&&!a.className.includes("selected")||t.onMouseLeave()}),l.addEventListener("click",function(){a=0===n?--a:a,n=0===n?11:--n,0===s?(s=0,u.innerHTML=e.getCalMonthHtml(a,n,s),c.innerHTML=e.getCalDateHtml(a,n)):u.childNodes[s].previousSibling.click()}),o.addEventListener("click",function(){a=11===n?++a:a,n=11===n?0:++n,s===t.monthNum-1?(s=0,u.innerHTML=e.getCalMonthHtml(a,n,s),c.innerHTML=e.getCalDateHtml(a,n)):u.childNodes[s].nextSibling.click()})}},{key:"on",value:function(e,t,a,n){t.addEventListener(e,function(e){var t=function e(t,a,n){if(t.parentNode===a)return t.nodeName.toLowerCase()===n||t.className.includes(n.substring(1))||t.id.includes(n.substring(1))?t:null;return t.parentNode!==a?e(t.parentNode,a,n):null}(e.target||e.srcElement,this,a),i=e.relatedTarget;t&&n&&n(this,t,i)})}},{key:"createElem",value:function(e,t,a){var n=document.createElement(e);return n.className=t,n.innerHTML=a,this.$el.append(n),n}},{key:"getPlanDate",value:function(e,a,n){for(var i=this.$options,r=this.getUniqueData(),s=0;s<r.length;s++)if(t(new Date(e,a,n))===r[s].date){return(this.getPlanDateData(e,a,n).length>1?'<i class="badge">多团</i>':0===r[s].number?'<i class="badge">'+i.sellOutText+"</i>":"")+'\n            <p class="price">&yen;'+r[s].price+'起</p>\n            <p class="number">'+this.toNumText(r[s].number)+"</p>"}}},{key:"getUniqueData",value:function(e){var t=[],a=this.$data.sort(function(e,t){return e.price-t.price}).reduce(function(e,a){return-1===t.indexOf(a.date)&&(e.push(a),t.push(a.date)),e},[]);return"date"===e?t:a}},{key:"getPlanDateData",value:function(){var e=1===arguments.length?t(new Date(arguments.length<=0?void 0:arguments[0])):t(new Date(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]));return this.$data.filter(function(t){return t.date===e}).sort(function(e,t){return e.price-t.price})}},{key:"getCalDateHtml",value:function(e,t){new Date;for(var a="",n=(this.$options,this.getCalDateData(e,t)),i=(this.getUniqueData("date"),0);i<n.length;i++)"prev"===n[i].status?a+=this.getPlanDateHtml(n[i].date,"prev"):"current"===n[i].status?a+=this.getPlanDateHtml(n[i].date,"current"):"next"===n[i].status&&(a+=this.getPlanDateHtml(n[i].date,"next"));return a}},{key:"getPlanDateHtml",value:function(e,t){var a=this.getUniqueData("date"),n=+e.split("/")[0],i=+e.split("/")[1]-1,r=+e.split("/")[2],s=new Date(e).getDay(),l=this.isToday(n,i,r),o=this.isDisabled(e)?"disabled":"enabled",u=this.$seletedDate===e?"selected":"",c="current"!==t?"invalid "+t:"",d="今天"===l?"today":"";return-1!==a.indexOf(e)?'<li class="'+o+" "+u+" "+c+" "+d+'" data-date="'+e+'" data-week="'+s+'">\n            <p class="date">'+l+"</p>\n            "+this.getPlanDate(n,i,r)+"\n          </li>":'<li class="'+c+" "+d+'" data-date="'+e+'" data-week="'+s+'"><p class="date">'+l+"</p></li>"}},{key:"getCalDateData",value:function(e,a){for(var n=[31,e%4==0&&e%100!=0||e%400==0?29:28,31,30,31,30,31,31,30,31,30,31],i=new Date(e,a,1).getDay(),r=i+(n[a]-1),s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(){return++e}}(),l=[],o=0;o<42;o++)if(o<i){var u=0===a?11:a-1,c=t(new Date(0===a?e-1:e,u,n[u]-(i-1-o)));l.push({date:c,status:"prev"})}else if(o>=i&&o<=r){var d=t(new Date(e,a,o-i+1));l.push({date:d,status:"current"})}else{var f=t(new Date(11===a?e+1:e,11===a?0:a+1,s()));l.push({date:f,status:"next"})}return l}},{key:"getCalMonthHtml",value:function(e,t,a){for(var n="",i=e,r=t,s=0;s<this.$options.monthNum;s++){r=t+s,t+s>11&&(i=e+1,r=t+s-12);var l=this.getMinPrice(i,r);n+='<li data-year="'+i+'" data-month="'+(r+1)+'" class="item \n          '+(s===a?"active":"")+'">\n          <p class="month">'+i+"年"+(r+1)+'月</p>\n          <p class="'+("无团期"===l?"none":"price")+'">'+("无团期"===l?"无团期":"&yen;"+l+"起")+"</p>\n        </li>"}return n}},{key:"getCalWeek",value:function(){for(var e=["日","一","二","三","四","五","六"],t="",a=0;a<e.length;a++)t+="<li>"+e[a]+"</li>";return t}},{key:"toNumText",value:function(e){var t=this.$options;return t.defineNumText?t.defineNumText:e>=t.maxNum?t.maxNumText:"余："+e}},{key:"isDisabled",value:function(e){var n=this.$options.disableDates;if("array"===a(n)){if(0===n.length)return!1;return-1!==n.map(function(e){return t(e)}).indexOf(e)}var i=new Date(e).getTime(),r=n.start?new Date(t(n.start)).getTime():(new Date).getTime(),s=n.end?new Date(t(n.end)).getTime():(new Date).getTime();return s-r<=0?(console.warn("disableDates的start日期不能大于end日期"),!1):i>=r&&i<=s}},{key:"getMinPrice",value:function(e,t,a){if(a)return this.getPlanDateData(e,t,a)[0];if(0===this.$data.length)return"无团期";var n=this.$data.filter(function(a){return+a.date.split("/")[0]===e&&+a.date.split("/")[1]===t+1});return 0!==n.length?n.map(function(e){return e.price}).sort(function(e,t){return e-t})[0]:"无团期"}},{key:"getStart",value:function(e){var t=new Date;new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime();this.$options.startByData}},{key:"isToday",value:function(e,t,a){var n=new Date;return new Date(e,t,a).getTime()===new Date(n.getFullYear(),n.getMonth(),n.getDate()).getTime()?"今天":a}}]),e}()});
//# sourceMappingURL=planCalendar.min.js.map
