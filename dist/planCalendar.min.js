"use strict";var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t,e){"function"==typeof define&&define.amd?define(e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?exports=module.exports=e():t.PlanCalendar=e()}(window,function(){function t(t){return t>=10?t:"0"+t}function e(e,a){var i="date"===n(e)?e:new Date(e),r=a||"yyyy/mm/dd",s=i.getFullYear(),o=t(i.getMonth()+1),l=t(i.getDate()),u=r.match(/[-/\s年月日]/g);return""+s+u[0]+o+u[1]+l+(u[2]?u[2]:"")}function n(t){var e=Object.prototype.toString;return"[object Array]"===e.call(t)?"array":"[object Object]"===e.call(t)?"object":"[object Date]"===e.call(t)?"date":void 0}function a(t,e){return t.className.includes(e)}function i(t,e){a(t,e)||(t.className+=" "+e)}function r(t,e){if(a(t,e)){var n=new RegExp("(\\s|^)"+e);t.className=t.className.replace(n,"")}}return function(){function t(a,i){_classCallCheck(this,t);this.$el=(r=a,1===r.nodeType?a:document.querySelector(a));var r;this.$options=function t(e,a){for(var i in e)void 0===a[i]?a[i]=e[i]:"object"===n(a[i])&&t(e[i],a[i]);return a}({monthNum:4,startByData:!1,showExpiredData:!1,minPriceText:"无团期",sellOutText:"售罄",maxNum:20,maxNumText:"充足",defineNumText:"",markDates:[],disableDates:[],onSelect:function(t){},onMouseEnter:function(t){},onMouseLeave:function(){},onMonthChange:function(t){}},i),this.$data=this.optimizeData(),this.$options.startByData=this.$options.startByData&&!this.$options.showExpiredData,this.$startDate=this.$data.length>0?this.$data[0].date:e(new Date),this.$seletedDate="",this.initCalendar()}return _createClass(t,[{key:"optimizeData",value:function(){var t=new Date,n=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime(),a=this.$options.markDates.reduce(function(t,n){return n.date=e(new Date(n.date)),t.push(n),t},[]).sort(function(t,e){return new Date(t.date).getTime()-new Date(e.date).getTime()});return this.$options.showExpiredData?a:a.filter(function(t){return n<=new Date(t.date).getTime()})}},{key:"initCalendar",value:function(){var t=this,e=this.$options,n=e.startByData?+this.$startDate.split("/")[0]:(new Date).getFullYear(),a=e.startByData?+this.$startDate.split("/")[1]-1:(new Date).getMonth(),s=0,o=this.createElem("span","calendar-btn-prev","&lt;"),l=this.createElem("span","calendar-btn-next","&gt;"),u=this.createElem("ul","calendar-month",this.getCalMonthHtml(n,a,s));this.createElem("ul","calendar-week",this.getCalWeek());var c=this.createElem("ul","calendar-date",this.getCalDateHtml(n,a));e.onMonthChange(this.getMonthData(n,a)),this.on("click",u,"li",function(o,l){o.childNodes.forEach(function(t){return r(t,"active")}),i(l,"active");for(var u=0;u<o.childNodes.length;u++)if(o.childNodes[u]===l){s=u;break}n=+l.getAttribute("data-year"),a=+l.getAttribute("data-month")-1,c.innerHTML=t.getCalDateHtml(n,a),e.onMonthChange(t.getMonthData(n,a))}),this.on("click",c,".enabled",function(n,a){n.childNodes.forEach(function(t){return r(t,"selected")}),i(a,"selected"),t.$seletedDate=a.getAttribute("data-date"),e.onSelect(t.getPlanDateData(t.$seletedDate)),a.className.includes("prev")&&u.childNodes[s].previousSibling.click(),a.className.includes("next")&&u.childNodes[s].nextSibling.click()}),this.on("mouseover",c,".enabled",function(n,a,i){var r=a.getAttribute("data-date");i===a||a.contains(i)||"enabled"!==a.className.trim()&&!a.className.includes("selected")||e.onMouseEnter(t.getPlanDateData(r))}),this.on("mouseout",c,".enabled",function(t,n,a){a===n||n.contains(a)||"enabled"!==n.className.trim()&&!n.className.includes("selected")||e.onMouseLeave()}),o.addEventListener("click",function(){n=0===a?--n:n,a=0===a?11:--a,0===s?(s=0,u.innerHTML=t.getCalMonthHtml(n,a,s),c.innerHTML=t.getCalDateHtml(n,a)):u.childNodes[s].previousSibling.click(),e.onMonthChange(t.getMonthData(n,a))}),l.addEventListener("click",function(){n=11===a?++n:n,a=11===a?0:++a,s===e.monthNum-1?(s=0,u.innerHTML=t.getCalMonthHtml(n,a,s),c.innerHTML=t.getCalDateHtml(n,a)):u.childNodes[s].nextSibling.click(),e.onMonthChange(t.getMonthData(n,a))})}},{key:"on",value:function(t,e,n,a){e.addEventListener(t,function(t){var e=function t(e,n,a){if("BODY"===e.parentNode.nodeName)return null;if(e.parentNode===n)return e.nodeName.toLowerCase()===a||e.className.includes(a.substring(1))||e.id.includes(a.substring(1))?e:null;return e.parentNode!==n?t(e.parentNode,n,a):null}(t.target||t.srcElement,this,n),i=t.relatedTarget;e&&a&&a(this,e,i)})}},{key:"createElem",value:function(t,e,n){var a=document.createElement(t);return a.className=e,a.innerHTML=n,this.$el.append(a),a}},{key:"getPlanDate",value:function(t,n,a){for(var i=this.$options,r=this.getUniqueData(),s=0;s<r.length;s++)if(e(new Date(t,n,a))===r[s].date){return(this.getPlanDateData(t,n,a).length>1?'<i class="badge">多团</i>':0===r[s].number?'<i class="badge">'+i.sellOutText+"</i>":"")+'\n            <p class="price">&yen;'+r[s].price+'起</p>\n            <p class="number">'+this.toNumText(r[s].number)+"</p>"}}},{key:"getUniqueData",value:function(t){var e=[],n=this.$data.sort(function(t,e){return t.price-e.price}).reduce(function(t,n){return-1===e.indexOf(n.date)&&(t.push(n),e.push(n.date)),t},[]);return"date"===t?e:n}},{key:"getPlanDateData",value:function(){var t=1===arguments.length?e(new Date(arguments.length<=0?void 0:arguments[0])):e(new Date(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]));return this.$data.filter(function(e){return e.date===t}).sort(function(t,e){return t.price-e.price})}},{key:"getCalDateData",value:function(t,n){for(var a=[31,t%4==0&&t%100!=0||t%400==0?29:28,31,30,31,30,31,31,30,31,30,31],i=new Date(t,n,1).getDay(),r=i+(a[n]-1),s=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(){return++t}}(),o=[],l=0;l<42;l++)if(l<i){var u=0===n?11:n-1,c=e(new Date(0===n?t-1:t,u,a[u]-(i-1-l)));o.push({date:c,status:"prev"})}else if(l>=i&&l<=r){var d=e(new Date(t,n,l-i+1));o.push({date:d,status:"current"})}else{var h=e(new Date(11===n?t+1:t,11===n?0:n+1,s()));o.push({date:h,status:"next"})}return o}},{key:"getCalDateHtml",value:function(t,e){new Date;for(var n="",a=(this.$options,this.getCalDateData(t,e)),i=(this.getUniqueData("date"),0);i<a.length;i++)"prev"===a[i].status?n+=this.getPlanDateHtml(a[i].date,"prev"):"current"===a[i].status?n+=this.getPlanDateHtml(a[i].date,"current"):"next"===a[i].status&&(n+=this.getPlanDateHtml(a[i].date,"next"));return n}},{key:"getPlanDateHtml",value:function(t,e){var n=this.getUniqueData("date"),a=+t.split("/")[0],i=+t.split("/")[1]-1,r=+t.split("/")[2],s=new Date(t).getDay(),o=this.isToday(a,i,r),l=this.isDisabled(t)?"disabled":"enabled",u=this.$seletedDate===t?"selected":"",c="current"!==e?"invalid "+e:"",d="今天"===o?"today":"";return-1!==n.indexOf(t)?'<li class="'+l+" "+u+" "+c+" "+d+'" data-date="'+t+'" data-week="'+s+'">\n            <p class="date">'+o+"</p>\n            "+this.getPlanDate(a,i,r)+"\n          </li>":'<li class="'+c+" "+d+'" data-date="'+t+'" data-week="'+s+'"><p class="date">'+o+"</p></li>"}},{key:"getCalMonthHtml",value:function(t,e,n){for(var a="",i=t,r=e,s=0;s<this.$options.monthNum;s++){r=e+s,e+s>11&&(i=t+1,r=e+s-12);var o=this.getMinPrice(i,r),l=o===this.$options.minPriceText?o:"&yen;"+o+"起";a+='<li data-year="'+i+'" data-month="'+(r+1)+'" class="item \n          '+(s===n?"active":"")+'">\n          <p class="month">'+i+"年"+(r+1)+'月</p>\n          <p class="'+(o===this.$options.minPriceText?"none":"price")+'">'+l+"</p>\n        </li>"}return a}},{key:"getCalWeek",value:function(){for(var t=["日","一","二","三","四","五","六"],e="",n=0;n<t.length;n++)e+="<li>"+t[n]+"</li>";return e}},{key:"getMonthData",value:function(t,e){if(0===this.$data.length)return this.$data;return this.$data.filter(function(n){return+n.date.split("/")[0]===t&&+n.date.split("/")[1]===e+1}).sort(function(t,e){return new Date(t.date).getTime()-new Date(e.date).getTime()})}},{key:"toNumText",value:function(t){var e=this.$options;return e.defineNumText?e.defineNumText:t>=e.maxNum?e.maxNumText:"余："+t}},{key:"isDisabled",value:function(t){var a=this.$options.disableDates;if("array"===n(a)){if(0===a.length)return!1;return-1!==a.map(function(t){return e(t)}).indexOf(t)}var i=new Date(t).getTime(),r=a.start?new Date(e(a.start)).getTime():(new Date).getTime(),s=a.end?new Date(e(a.end)).getTime():(new Date).getTime();return s-r<=0?(console.warn("disableDates的start日期不能大于end日期"),!1):i>=r&&i<=s}},{key:"getMinPrice",value:function(t,e,n){if(n)return this.getPlanDateData(t,e,n)[0];if(0===this.$data.length)return this.$options.minPriceText;var a=this.$data.filter(function(n){return+n.date.split("/")[0]===t&&+n.date.split("/")[1]===e+1});return 0!==a.length?a.map(function(t){return t.price}).sort(function(t,e){return t-e})[0]:this.$options.minPriceText}},{key:"getStart",value:function(t){var e=new Date;new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime();this.$options.startByData}},{key:"isToday",value:function(t,e,n){var a=new Date;return new Date(t,e,n).getTime()===new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime()?"今天":n}}]),t}()});
//# sourceMappingURL=planCalendar.min.js.map
