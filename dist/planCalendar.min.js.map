{"version":3,"sources":["planCalendar.js"],"names":["w","d","$","PlanCalendar","elem","options","arguments","length","undefined","_classCallCheck","this","defaults","monthNum","sellOutText","isTips","maxNum","maxNumText","onSelect","dataIndex","initTips","i","markDates","j","dateItem","data","selectedDate","$cal","html","$calMonth","children","$calDate","weekCn","_ref","now","getMonth","getDate","m","getCalMonth","y","on","index","Date","mm","getFullYear","that","getCalDate","yy","selectCalDate","_createClass","key","value","_len","addClass","Array","_key","date","indexOf","t","join","days","formatDate","year","month","_this","filter","curVal","dates","split","parseInt","prices","minPrice","map","price","sort","$item","_this2","op","forEach","priceHtml","number","attr","getEndDate","append","dataHtml","hasClass","_this3","getDay","mNum","mHtml","getMinPrice","monthDays","nextMonthDate","startDate","endDate","$calDateItem","curDate","renderPlanData","eq","prevMonth","prevYear","febDays","nextYear","nextMonth","calGridNum","_this4","$curMonthItem","curMonth","obj","siblings","renderCalDate","prev","click","$selectedItem","callback","window","document"],"mappings":"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","file":"planCalendar.min.js","sourcesContent":[";((w, d, $) => {\r\n  class PlanCalendar {\r\n    constructor(elem, options = {}) {\r\n      const defaults = {\r\n        monthNum: 4,            // Number 默认值 4，月份显示个数\r\n        sellOutText: '售罄',    // String 默认值 '售罄'，余位为0时显示文字\r\n        isTips: false,         // Boolean 默认值 false，是否显示提示层 \r\n        maxNum: 20,            // Number  默认值 20，大于等于指定余位显示 maxNumText 的值\r\n        maxNumText: '充足',    // String  默认值 '充足'，配置大于等于指定余位显示文字\r\n        markDates: [],        // Array  默认值 []， 格式化好的团期数据        \r\n        onSelect: function (dateItem, dataIndex) { // 选择团期之后的回调，dateItem：选中日期项, dataIndex: 数据的索引值\r\n        },\r\n        initTips: function (dataIndex) { // 初始化tips文档内容，dataIndex: 数据的索引值\r\n          // return String 文档内容\r\n        }\r\n\r\n      };\r\n      for (var i in defaults) {\r\n        if (typeof options[i] === 'undefined') {\r\n          options[i] = defaults[i];\r\n        } else if (typeof options[i] === 'object') {\r\n          for (var j in options[i]) {\r\n            if (typeof options[i][j] === 'undefined') {\r\n              options[i][j] = defaults[i][j];\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      this.options = options;\r\n      this.data = this.options.markDates;\r\n      this.options.monthNum = this.options.monthNum > 11 ? 11 : this.options.monthNum; // 选项卡个数不能超过11个\r\n      // 已选日期\r\n      this.selectedDate = undefined;\r\n      // 日历dom结构\r\n      this.$cal = $(elem);\r\n      this.$cal.html('<ul class=\"calendar-month\"> </ul> <ul class=\"calendar-week\"> <li>日</li> <li>一</li> <li>二</li> <li>三</li> <li>四</li> <li>五</li> <li>六</li> </ul> <ul class=\"calendar-date\"> </ul>');\r\n      this.$calMonth = this.$cal.children('.calendar-month');\r\n      this.$calDate = this.$cal.children('.calendar-date');\r\n      this.weekCn = ['日', '一', '二', '三', '四', '五', '六'];\r\n      // 获取当前时间\r\n      const now = new Date();\r\n      const [y, m, d] = [now.getFullYear(), now.getMonth(), now.getDate()];\r\n\r\n      this.getCalMonth(y, m, this.options.monthNum);\r\n      this.getCalDate(y, m, d);\r\n\r\n      const that = this;\r\n      this.$calMonth.on('click', 'li', function () {\r\n        $(this).addClass('active')\r\n          .siblings()\r\n          .removeClass('active');\r\n        let index = $(this).index();\r\n        let yy = m + index > 11 ? (y + 1) : y;\r\n        let mm = m + index > 11 ? (m - 12 + index) : (m + index);\r\n        that.getCalDate(yy, mm);\r\n      });\r\n      this.$calDate.on('click', 'li.enabled', function() {\r\n        that.selectCalDate(this, that.options.onSelect);\r\n      });\r\n    }\r\n    /**\r\n     * 格式化化日\r\n     * 统一返回： YY-MM-DD\r\n     */\r\n    formatDate(...date) {\r\n      if (typeof date[0] === 'string' && date[0].indexOf('-') !== -1 && date[0].length === 8) {\r\n        return date[0];\r\n      }\r\n      const t = date.length === 3 ? new Date(date[0], date[1], date[2]) : new Date(date[0]);\r\n      let m = (t.getMonth() + 1) < 10 ? ('0' + (t.getMonth() + 1)) : (t.getMonth() + 1);\r\n      let d = t.getDate() < 10 ? ('0' + t.getDate()) : t.getDate();\r\n      const dates = [t.getFullYear(), m, d];\r\n\r\n      return dates.join('-');\r\n    }\r\n    /**\r\n     * 获取指定日期指定天数之后的结束日期\r\n     * @param {* string} date 开始日期 yy-mm-dd\r\n     * @param {* number} days 天数\r\n     */\r\n    getEndDate(date, days) {\r\n      const t = new Date(date);\r\n      return this.formatDate(t.getFullYear(), t.getMonth(), t.getDate()+days);\r\n    }\r\n    /**\r\n     * 获取指定月下在团期数据中的价格最小值，\r\n     * 若该月无团则显示为“无团期”\r\n     */\r\n    getMinPrice(year, month) {\r\n      if (this.data.length === 0) {\r\n        return '<p class=\"none\">无团期</p>';\r\n      }\r\n      const prices = this.data.filter((curVal) => {\r\n        return (this.formatDate(curVal.date).split('-')[0] == year &&\r\n          parseInt(this.formatDate(curVal.date).split('-')[1]) == month)\r\n      });\r\n      if (prices.length === 0) {\r\n        return '<p class=\"none\">无团期</p>';\r\n      }\r\n      const minPrice = prices.map((curVal) => {\r\n        return curVal.price;\r\n      }).sort()[0];\r\n      let priceHtml = minPrice \r\n        ? `<p class=\"price\">&yen;${minPrice}起</p>`\r\n        : `<p class=\"price\">未设置</p>`\r\n      return priceHtml;\r\n    }\r\n    /**\r\n     * 渲染日期项中的团期数据\r\n     * @param {* object}  jQuery 对象，日历表格项\r\n     * @param {* number} year 当前年份\r\n     * @param {* number} month 当前月份\r\n     * @param {* number} date 当前日期\r\n     */\r\n    renderPlanData($item, year, month, date) {\r\n      const op = this.options;\r\n      const toNumTxt = (number) => {\r\n        if (number < op.maxNum) {\r\n          return '余：' + number;\r\n        } else if (number >= op.maxNum) {\r\n          return op.maxNumText;\r\n        } else {\r\n          return '';\r\n        }\r\n      };\r\n      // 输出对应日期的团期数据\r\n      this.data.forEach((curVal, i) => {\r\n        if (this.formatDate(curVal.date) === this.formatDate(year, month, date)) {\r\n          let priceHtml = typeof curVal.price === 'undefined' \r\n            ? ''\r\n            : `<p class=\"price\">&yen;${curVal.price}起</p>`;\r\n          let dataHtml = `${ priceHtml }<p class=\"number\">${ toNumTxt(curVal.number) }</p>`;\r\n\r\n          $item.addClass('enabled')\r\n            .attr('data-start', this.formatDate(curVal.date))\r\n            .attr('data-end', this.getEndDate(curVal.date, curVal.days))\r\n            .append(dataHtml);\r\n          if (this.formatDate(curVal.date) === this.selectedDate) {\r\n            $item.addClass('selected');\r\n          }\r\n          if (typeof curVal.number !== 'undefined' && curVal.number === 0) {\r\n            $item.append(`<i class=\"badge\">${this.options.sellOutText}</i>`); \r\n          }\r\n          if (this.options.isTips && this.options.initTips !== 'undefined' && !$item.hasClass('invalid')) {\r\n            $item.append(this.options.initTips(i));   \r\n          }\r\n        }\r\n      });\r\n    }\r\n    /**\r\n     * 渲染网格中的日期\r\n     * @param {* object}  jQuery 对象，日历表格项\r\n     * @param {* number} year 当前年份\r\n     * @param {* number} month 当前月份\r\n     * @param {* number} date 当前日期\r\n     */\r\n    renderCalDate($item, year, month, date) {\r\n      $item.attr('data-date', () => {\r\n          return this.formatDate(year, month, date);\r\n        })\r\n        .attr('data-week', () => {\r\n          return this.weekCn[new Date(year, month, date).getDay()];\r\n        })\r\n        .html(`<p class=\"date\">${ date }</p>`);\r\n    }\r\n    /**\r\n     * 获取指定年配置的所有月份\r\n     * @param {* number} year 当前年份\r\n     * @param {* number} month 当前月份\r\n     * @param {* number} mNum 月份选项卡数量\r\n     */\r\n    getCalMonth(year, month, mNum) {\r\n      let mHtml = '';\r\n      for (let i = 0; i < mNum; i++) {\r\n        if (month + i > 11) { //\r\n          year++;\r\n          month = -i;\r\n        }\r\n        let m = month + 1 + i;\r\n        mHtml += `<li data-year=\"${year}\"  data-month=\"${m}\" class=\"${ i===0 ? 'active' : '' }\"><p class=\"month\">${year}年${m }月</p>${ this.getMinPrice(year, m) }</li>`;\r\n      }\r\n      this.$calMonth.html(mHtml);\r\n    }\r\n    /**\r\n     * 获取指定年月所有日期，以及部分上下月日期\r\n     * @param {* number} year 当前年份\r\n     * @param {* number} month 当前月份 \r\n     * @param {* number} date 当前日期，默认值=1 \r\n     */\r\n    getCalDate(year, month, date) {\r\n      let data = this.data;\r\n      let now = new Date();\r\n      let y = year;\r\n      let m = month;\r\n      let d = date ? date : now.getDate();\r\n      let febDays = (y % 4 == 0 && y % 100 != 0) || (y % 400 == 0) ? 29 : 28; //闰年二月份天数\r\n      const monthDays = [31, febDays, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\r\n      const calGridNum = 42; //日历网格个数\r\n      let nextMonthDate = 0; //下一个月的日期\r\n      let startDate = new Date(y, m, 1).getDay(); //当月第一天\r\n      let endDate = startDate + monthDays[m]; //当月最后一天\r\n      // 初始化日期表格\r\n      this.$calDate.html('');\r\n      for (let i = 0; i < calGridNum; i++) {\r\n        this.$calDate.append('<li></li>');\r\n      }\r\n      let $calDateItem = this.$calDate.children('li');\r\n      $calDateItem.removeAttr('class');\r\n      for (let i = 0; i < calGridNum; i++) {\r\n        // 显示当月\r\n        if (i >= startDate && i < endDate) {\r\n          let curDate = i - (startDate - 1);\r\n          // 日期插入网格中\r\n          this.renderCalDate($calDateItem.eq(i), y, m, curDate);\r\n          this.renderPlanData($calDateItem.eq(i), y, m, curDate);\r\n          // 显示今天\r\n          if (y === now.getFullYear() && m === now.getMonth() && d === curDate) {\r\n            $calDateItem.eq(i).addClass('today')\r\n              .children('.date').html('今天');\r\n          }\r\n        } else if (i < startDate) { // 显示上月\r\n          let prevMonth = m === 0 ? 11 : (m - 1); // 跨年时，当m=0时, prevMonth=11;\r\n          let prevYear = m === 0 ? (y - 1) : y; // 跨年时，当m=0时, prevYear=y-1;\r\n\r\n          for (let j = monthDays[prevMonth]; j > monthDays[prevMonth] - startDate; j--) {\r\n            if (i === monthDays[prevMonth] - j) {\r\n              let curDate = monthDays[prevMonth] - ((startDate - 1) - i); // 获取当天日期\r\n              $calDateItem.eq(i).addClass('invalid');\r\n              // 日期插入网格中\r\n              this.renderCalDate($calDateItem.eq(i), prevYear, prevMonth, curDate);\r\n              // 输出对应日期的团期数据\r\n              this.renderPlanData($calDateItem.eq(i), prevYear, prevMonth, curDate);\r\n              break;\r\n            }\r\n          }\r\n        } else {\r\n          let data = this.data;\r\n          let nextMonth = m === 11 ? 0 : (m + 1);\r\n          let nextYear = m === 11 ? (y + 1) : y;\r\n          let curDate = ++nextMonthDate; // 获取当天日期\r\n\r\n          $calDateItem.eq(i).addClass('invalid');\r\n          // 日期插入网格中\r\n          this.renderCalDate($calDateItem.eq(i), nextYear, nextMonth, curDate);\r\n          // 输出对应日期的团期数据\r\n          this.renderPlanData($calDateItem.eq(i), nextYear, nextMonth, curDate);\r\n        }\r\n      }\r\n    }\r\n    /**\r\n     * \r\n     * @param {* object} obj dom 对象\r\n     * @param {* function } callback 回调，参数：dateItem 已选日期项；dataIndex： 团期数据索引\r\n     */\r\n    selectCalDate(obj, callback) {\r\n  \r\n      let curDate = $(obj).attr('data-date');\r\n      let $curMonthItem = this.$calMonth.children('li.active');\r\n      let curMonth = ($curMonthItem.attr('data-month') - 1);\r\n      let prevMonth = curMonth === 0 ? 11 : (curMonth - 1);\r\n      let nextMonth = curMonth === 11 ? 0 : (curMonth + 1);\r\n\r\n      $(obj).addClass('selected')\r\n        .siblings().removeClass('selected');\r\n      this.selectedDate = curDate;\r\n      this.data.forEach((curVal, i) => {\r\n        if (this.formatDate(curVal.date) === curDate) {\r\n          if (new Date(curVal.date).getMonth() === nextMonth) {\r\n            $curMonthItem.next().click();\r\n          } else if (new Date(curVal.date).getMonth() === prevMonth) {\r\n            $curMonthItem.prev().click();\r\n          }\r\n          // 初始化日期dom后重新获取已选日期\r\n          let $selectedItem = this.$calDate.children('li.selected');\r\n          if (typeof callback === 'function') {\r\n            callback($selectedItem, i);\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n  w.PlanCalendar = PlanCalendar;\r\n})(window, document, $);"]}